import { R as m } from "./assets/index-CejZ-VRH.js"; const S = ["google-analytics.com", "googletagmanager.com", "doubleclick.net", "facebook.net", "facebook.com/tr", "adnxs.com", "quantserve.com", "scorecardresearch.com", "amazon-adsystem.com", "googleadservices.com", "hotjar.com", "criteo.com", "taboola.com", "outbrain.com", "mixpanel.com", "segment.io", "analytics.google.com", "connect.facebook.net", "static.ads-twitter.com", "pixel.wp.com", "bat.bing.com", "mc.yandex.ru", "drift.com", "intercom.io", "clarity.ms", "newrelic.com", "datadoghq.com", "crazyegg.com", "piwik.pro", "matomo.org"]; class b { static isTracker(r) { try { const t = new URL(r).hostname; return S.some(o => t.includes(o)) } catch { return !1 } } static getBaseDomain(r) { try { const t = new URL(r).hostname, o = t.split("."); return o.length >= 2 ? o.slice(-2).join(".") : t } catch { return "" } } } const a = {}; chrome.runtime.onInstalled.addListener(() => { chrome.storage.local.set({ threatHistory: [] }), console.log("SherlockWeb AI initialized") }); chrome.webRequest.onBeforeRequest.addListener(e => { if (!(e.tabId < 0)) { a[e.tabId] || (a[e.tabId] = { trackers: new Set, external: new Set }); try { const t = new URL(e.url).hostname; a[e.tabId].external.add(t), b.isTracker(e.url) && a[e.tabId].trackers.add(e.url) } catch { } } }, { urls: ["<all_urls>"] }); chrome.tabs.onUpdated.addListener(async (e, r, t) => { if (r.status === "loading" && (a[e] = { trackers: new Set, external: new Set }, console.log(`[SherlockWeb AI] Tab ${e} loading, resetting state.`)), r.status === "complete" && t.url && !t.url.startsWith("chrome:") && !t.url.startsWith("chrome-extension:")) { const o = t.url; console.log(`[SherlockWeb AI] Analyzing: ${o}`); const c = new URL(o).hostname, u = m.analyzeDomain(o), n = a[e] || { trackers: new Set, external: new Set }, h = Array.from(n.external).filter(s => s !== c && s !== "localhost").length, i = { connection: o.startsWith("https") ? 0 : 40, privacy: Math.min(Math.max(0, n.trackers.size - 3) * 5, 100), network: Math.min(Math.max(0, h - 5) * 5, 100), domain: u.score }, l = m.calculateScore(i); console.log(`[SherlockWeb AI] Final Score for ${c}: ${l}`, i); const d = { url: o, domain: c, score: l, status: m.getStatus(l), factors: i, trackersCount: n.trackers.size, externalDomainsCount: h, timestamp: Date.now(), issues: u.issues }; chrome.storage.local.get(["threatHistory"], s => { const g = (s.threatHistory || []).filter(f => f.url !== o), y = [d, ...g].slice(0, 50); chrome.storage.local.set({ threatHistory: y }) }), chrome.tabs.sendMessage(e, { type: "ANALYSIS_UPDATE", payload: d }).catch(() => { }) } }); chrome.tabs.onRemoved.addListener(e => { delete a[e] }); chrome.runtime.onMessage.addListener(e => { e.type === "SECURITY_ALERT" && console.warn("Security Alert received:", e.payload), e.type === "OPEN_DASHBOARD" && chrome.tabs.create({ url: "dashboard.html" }) });
